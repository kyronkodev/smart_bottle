<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Smart Bottle</title>
  <link rel="stylesheet" href="/assets/css/dashboard.css">
  <style>
    .register-container { max-width: 600px; margin: 0 auto; padding: var(--spacing-8); }
    .page-title { font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-2); }
    .page-subtitle { font-size: var(--font-size-base); color: var(--color-text-secondary); margin-bottom: var(--spacing-8); }
    .form-card { background: var(--color-white); border-radius: var(--radius-2xl); padding: var(--spacing-8); box-shadow: var(--shadow-sm); }
    .form-group { margin-bottom: var(--spacing-6); }
    .form-label { display: block; font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); color: var(--color-text-primary); margin-bottom: var(--spacing-2); }
    .form-input { width: 100%; padding: var(--spacing-3) var(--spacing-4); border: 2px solid var(--color-gray-200); border-radius: var(--radius-md); font-size: var(--font-size-base); transition: all var(--transition-base); }
    .form-input:focus { outline: none; border-color: var(--color-primary); }
    .form-help { font-size: var(--font-size-sm); color: var(--color-text-tertiary); margin-top: var(--spacing-2); }
    .info-box { background: var(--color-info-lighter); border-left: 4px solid var(--color-info); padding: var(--spacing-4); border-radius: var(--radius-md); margin-bottom: var(--spacing-6); }
    .info-title { font-size: var(--font-size-base); font-weight: var(--font-weight-semibold); color: var(--color-info); margin-bottom: var(--spacing-2); }
    .info-steps { font-size: var(--font-size-sm); color: var(--color-text-secondary); line-height: 1.6; }
    .info-steps li { margin-bottom: var(--spacing-2); }
    .form-actions { display: flex; gap: var(--spacing-3); margin-top: var(--spacing-8); }
    .btn { flex: 1; padding: var(--spacing-3) var(--spacing-6); border-radius: var(--radius-md); border: none; font-size: var(--font-size-base); font-weight: var(--font-weight-medium); cursor: pointer; transition: all var(--transition-base); }
    .btn-primary { background: var(--color-primary); color: var(--color-white); }
    .btn-primary:hover { background: var(--color-primary-dark); }
    .btn-secondary { background: var(--color-gray-100); color: var(--color-text-secondary); }
    .btn-secondary:hover { background: var(--color-gray-200); }
  </style>
</head>
<body>
  <div class="register-container">
    <h1 class="page-title">â• ìƒˆ ê¸°ê¸° ë“±ë¡</h1>
    <p class="page-subtitle">ìŠ¤ë§ˆíŠ¸ ì –ë³‘ ê¸°ê¸°ë¥¼ ë“±ë¡í•˜ì—¬ ìˆ˜ìœ  ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ê¸°ë¡í•˜ì„¸ìš”</p>

    <div class="info-box">
      <h3 class="info-title">ğŸ“± ê¸°ê¸° ë“±ë¡ ì „ ì¤€ë¹„ì‚¬í•­</h3>
      <ol class="info-steps">
        <li><strong>ESP32 ê¸°ê¸° ì „ì›ì„ ì¼œê³  WiFiì— ì—°ê²°</strong>í•˜ì„¸ìš”</li>
        <li>ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„°ì—ì„œ <strong>Device UUID</strong>ë¥¼ í™•ì¸í•˜ì„¸ìš” (ì˜ˆ: AABBCCDDEEFF)</li>
        <li>ë¹ˆ ë¶„ìœ í†µì„ ë¬´ê²Œ ì„¼ì„œì— ì˜¬ë ¤ <strong>ë¶„ìœ í†µ ë¬´ê²Œ</strong>ë¥¼ ì¸¡ì •í•˜ì„¸ìš”</li>
      </ol>
    </div>

    <div class="form-card">
      <form id="registerForm">
        <div class="form-group">
          <label class="form-label" for="device_uuid">ê¸°ê¸° UUID *</label>
          <input
            type="text"
            id="device_uuid"
            name="device_uuid"
            class="form-input"
            placeholder="ì˜ˆ: AABBCCDDEEFF"
            required
          >
          <p class="form-help">ESP32ì˜ MAC ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div class="form-group">
          <label class="form-label" for="device_name">ê¸°ê¸° ì´ë¦„ *</label>
          <input
            type="text"
            id="device_name"
            name="device_name"
            class="form-input"
            placeholder="ì˜ˆ: ê±°ì‹¤ ìŠ¤ë§ˆíŠ¸ ì –ë³‘"
            required
          >
          <p class="form-help">ê¸°ê¸°ë¥¼ ì‰½ê²Œ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
        </div>

        <div class="form-group">
          <label class="form-label" for="bottle_weight">ë¶„ìœ í†µ ë¬´ê²Œ (g) <span style="color: var(--color-text-tertiary);">(ì„ íƒì‚¬í•­)</span></label>
          <input
            type="number"
            id="bottle_weight"
            name="bottle_weight"
            class="form-input"
            placeholder="ì˜ˆ: 85.5"
            step="0.1"
            min="0"
          >
          <p class="form-help">
            ğŸ’¡ ë‚˜ì¤‘ì— ê¸°ê¸° ëª©ë¡ì—ì„œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            ìˆ˜ìœ  ê¸°ë¡ì„ ì‹œì‘í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ë“±ë¡í•´ì£¼ì„¸ìš”!
          </p>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="location.href='/devices'">
            ì·¨ì†Œ
          </button>
          <button type="submit" class="btn btn-primary">
            ğŸ“± ê¸°ê¸° ë“±ë¡
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const deviceUuid = document.getElementById('device_uuid').value.trim();
      const deviceName = document.getElementById('device_name').value.trim();
      const bottleWeightInput = document.getElementById('bottle_weight').value;
      const bottleWeight = bottleWeightInput ? parseFloat(bottleWeightInput) : 0;

      if (!deviceUuid || !deviceName) {
        alert('ê¸°ê¸° UUIDì™€ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
        return;
      }

      try {
        const response = await fetch('/devices/api/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            device_uuid: deviceUuid,
            device_name: deviceName,
            bottle_weight: bottleWeight
          })
        });

        const result = await response.json();

        if (result.success) {
          if (bottleWeight > 0) {
            alert('ê¸°ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          } else {
            alert('ê¸°ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê¸°ê¸° ëª©ë¡ì—ì„œ "ë¶„ìœ í†µ ë¬´ê²Œ ë“±ë¡" ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¬´ê²Œë¥¼ ì„¤ì •í•˜ì„¸ìš”.');
          }
          location.href = '/devices';
        } else {
          if (result.error.includes('already exists')) {
            alert('ì´ë¯¸ ë“±ë¡ëœ ê¸°ê¸° UUIDì…ë‹ˆë‹¤.');
          } else {
            alert(`ë“±ë¡ ì‹¤íŒ¨: ${result.error}`);
          }
        }
      } catch (error) {
        console.error('Register error:', error);
        alert('ê¸°ê¸° ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
  </script>
</body>
</html>
